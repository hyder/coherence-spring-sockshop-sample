# Copyright (c) 2022, Oracle and/or its affiliates.
# Licensed under the Universal Permissive License v 1.0 as shown at
# https://oss.oracle.com/licenses/upl.
version: 0.1
component: build
timeoutInSeconds: 6000
runAs: root
shell: bash   
steps:
  - type: Command
    name: "Update OAM YAML file"
    timeoutInSeconds: 6000
    command: |
      cd ${OCI_PRIMARY_SOURCE_DIR}/k8s/application/oam/
      echo $BUILDRUN_HASH
      echo ${OCI_PIPELINE_ID}
      envsubst < ${OCI_PRIMARY_SOURCE_DIR}/k8s/templates/spring-components-template.yaml > spring-components.yaml
      git config user.email "${OCI_PIPELINE_ID}@example.com"; git config user.name "${OCI_PIPELINE_ID}"; git add . 
      git commit -m "Build ${BUILDRUN_HASH}"
      echo "changes committed"
      echo "user.email ${OCI_PIPELINE_ID}@example.com"
      echo "user.name ${OCI_PIPELINE_ID}"
      git push origin deploy
      echo "git pushed"
      #exit 1